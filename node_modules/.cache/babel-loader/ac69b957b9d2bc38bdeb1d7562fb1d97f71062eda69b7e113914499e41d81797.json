{"ast":null,"code":"import React,{useState,useEffect,useContext}from'react';import{useNavigate}from'react-router-dom';import GameContext from'../contexts/GameContext';import{createGameRoomInFirebase}from'../services/firebaseService';import{database}from'../firebase';import{ref,onValue,remove}from'firebase/database';import'../styles/GameLobby.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MAX_PLAYERS=13;const GameLobby=()=>{const{gameState}=useContext(GameContext);const playerName=gameState.playerName;const navigate=useNavigate();const[rooms,setRooms]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{const roomsRef=ref(database,'rooms');const unsubscribe=onValue(roomsRef,async snapshot=>{const data=snapshot.val();if(data){const roomList=Object.entries(data).map(_ref=>{let[id,room]=_ref;return{id,...room};});const filteredRooms=await Promise.all(roomList.map(async room=>{const currentPlayers=room.players?room.players.length:0;if(currentPlayers===0){try{await remove(ref(database,`rooms/${room.id}`));console.log(`플레이어 0명이라 방 삭제됨: ${room.name}`);return null;}catch(error){console.error('방 삭제 실패:',error);return room;// 삭제 실패한 건 유지\n}}return room;}));setRooms(filteredRooms.filter(r=>r!==null));}else{setRooms([]);}setLoading(false);});return()=>unsubscribe();},[]);const handleCreateRoom=async()=>{if(!playerName){alert('플레이어 이름을 먼저 입력하세요.');return;}try{const gameName=prompt('생성할 방 이름을 입력하세요.');if(gameName){const roomId=await createGameRoomInFirebase(gameName,playerName);navigate(`/game/${roomId}`);}}catch(error){console.error('방 생성 실패:',error);alert('방 생성 중 오류가 발생했습니다.');}};const handleJoinRoom=roomId=>{navigate(`/game/${roomId}`);};return/*#__PURE__*/_jsxs(\"div\",{className:\"lobby-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uB85C\\uBE44\"}),/*#__PURE__*/_jsx(\"div\",{className:\"lobby-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"primary\",onClick:handleCreateRoom,children:\"\\uC0C8 \\uBC29 \\uB9CC\\uB4E4\\uAE30\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"room-list\",children:loading?/*#__PURE__*/_jsx(\"p\",{children:\"\\uBC29 \\uBAA9\\uB85D \\uBD88\\uB7EC\\uC624\\uB294 \\uC911...\"}):rooms.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"room-cards\",children:rooms.map(room=>{const currentPlayers=room.players?room.players.length:0;const isFull=currentPlayers>=MAX_PLAYERS;return/*#__PURE__*/_jsxs(\"div\",{className:`room-card ${isFull?'full':''}`,onClick:()=>!isFull&&handleJoinRoom(room.id),style:{cursor:isFull?'not-allowed':'pointer'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"room-name\",children:room.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-players\",children:[currentPlayers,\" / \",MAX_PLAYERS,\" \\uBA85\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-host\",children:[\"\\uBC29\\uC7A5: \",room.host]})]},room.id);})}):/*#__PURE__*/_jsx(\"p\",{children:\"\\uC0DD\\uC131\\uB41C \\uBC29\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})})]});};export default GameLobby;","map":{"version":3,"names":["React","useState","useEffect","useContext","useNavigate","GameContext","createGameRoomInFirebase","database","ref","onValue","remove","jsx","_jsx","jsxs","_jsxs","MAX_PLAYERS","GameLobby","gameState","playerName","navigate","rooms","setRooms","loading","setLoading","roomsRef","unsubscribe","snapshot","data","val","roomList","Object","entries","map","_ref","id","room","filteredRooms","Promise","all","currentPlayers","players","length","console","log","name","error","filter","r","handleCreateRoom","alert","gameName","prompt","roomId","handleJoinRoom","className","children","onClick","isFull","style","cursor","host"],"sources":["C:/Users/USER/Desktop/ssssss/frontend/src/components/GameLobby.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport GameContext from '../contexts/GameContext';\nimport { createGameRoomInFirebase } from '../services/firebaseService';\nimport { database } from '../firebase';\nimport { ref, onValue, remove } from 'firebase/database';\n\nimport '../styles/GameLobby.css';\n\nconst MAX_PLAYERS = 13;\n\nconst GameLobby = () => {\n  const { gameState } = useContext(GameContext);\n  const playerName = gameState.playerName;\n  const navigate = useNavigate();\n  const [rooms, setRooms] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const roomsRef = ref(database, 'rooms');\n\n    const unsubscribe = onValue(roomsRef, async (snapshot) => {\n      const data = snapshot.val();\n\n      if (data) {\n        const roomList = Object.entries(data).map(([id, room]) => ({\n          id,\n          ...room\n        }));\n\n        const filteredRooms = await Promise.all(roomList.map(async (room) => {\n          const currentPlayers = room.players ? room.players.length : 0;\n          if (currentPlayers === 0) {\n            try {\n              await remove(ref(database, `rooms/${room.id}`));\n              console.log(`플레이어 0명이라 방 삭제됨: ${room.name}`);\n              return null;\n            } catch (error) {\n              console.error('방 삭제 실패:', error);\n              return room; // 삭제 실패한 건 유지\n            }\n          }\n          return room;\n        }));\n\n        setRooms(filteredRooms.filter(r => r !== null));\n      } else {\n        setRooms([]);\n      }\n\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const handleCreateRoom = async () => {\n    if (!playerName) {\n      alert('플레이어 이름을 먼저 입력하세요.');\n      return;\n    }\n\n    try {\n      const gameName = prompt('생성할 방 이름을 입력하세요.');\n      if (gameName) {\n        const roomId = await createGameRoomInFirebase(gameName, playerName);\n        navigate(`/game/${roomId}`);\n      }\n    } catch (error) {\n      console.error('방 생성 실패:', error);\n      alert('방 생성 중 오류가 발생했습니다.');\n    }\n  };\n\n  const handleJoinRoom = (roomId) => {\n    navigate(`/game/${roomId}`);\n  };\n\n  return (\n    <div className=\"lobby-container\">\n      <h2>로비</h2>\n\n      <div className=\"lobby-actions\">\n        <button className=\"primary\" onClick={handleCreateRoom}>\n          새 방 만들기\n        </button>\n      </div>\n\n      <div className=\"room-list\">\n        {loading ? (\n          <p>방 목록 불러오는 중...</p>\n        ) : rooms.length > 0 ? (\n          <div className=\"room-cards\">\n            {rooms.map((room) => {\n              const currentPlayers = room.players ? room.players.length : 0;\n              const isFull = currentPlayers >= MAX_PLAYERS;\n\n              return (\n                <div\n                  key={room.id}\n                  className={`room-card ${isFull ? 'full' : ''}`}\n                  onClick={() => !isFull && handleJoinRoom(room.id)}\n                  style={{ cursor: isFull ? 'not-allowed' : 'pointer' }}\n                >\n                  <div className=\"room-name\">{room.name}</div>\n                  <div className=\"room-players\">{currentPlayers} / {MAX_PLAYERS} 명</div>\n                  <div className=\"room-host\">방장: {room.host}</div>\n                </div>\n              );\n            })}\n          </div>\n        ) : (\n          <p>생성된 방이 없습니다.</p>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default GameLobby;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}